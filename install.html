<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Install BED App</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="theme-color" content="#1E90FF">

<style>
  :root { --bed-blue:#1E90FF; --ink:#2b2b2b; --muted:#555; --line:#e5e7eb; --bg:#F7F8FA; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .appbar{position:sticky; top:0; background:var(--bed-blue); color:#fff; padding:14px 16px; font-weight:700; letter-spacing:.2px; display:flex; align-items:center; gap:10px; box-shadow:0 1px 0 rgba(0,0,0,.06);}
  main{max-width:560px;margin:18px auto;padding:0 16px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:20px}
  h1{margin:6px 0 10px;font-size:26px;line-height:1.2;color:#2b2b2b}
  h2{margin:4px 0 8px;font-size:20px;line-height:1.25;color:#2b2b2b}
  p{margin:8px 0}
  .muted{color:var(--muted)}
  .btn{display:inline-block;padding:12px 16px;border-radius:14px;border:1px solid var(--bed-blue);text-decoration:none}
  .btn.primary{background:var(--bed-blue);color:#fff;border:none;font-weight:600}
  .hide{display:none}
  .title-row{display:flex;align-items:center;gap:12px}
  .badge{width:36px;height:36px;border-radius:10px;overflow:hidden;background:#1E90FF;display:grid;place-items:center;color:#fff;font-weight:800}
  .badge img{width:100%;height:100%;object-fit:cover;display:block}
  .fallback{display:grid;place-items:center;width:100%;height:100%;font-size:14px;letter-spacing:.6px}
  .note{font-size:13px;color:#777;margin-top:6px}
</style>
</head>
<body>
  <header class="appbar">
    BED HOSPITALITY 2.0 PEER REVIEW
  </header>

  <main>
    <div class="card" id="cardInstall">
      <div class="title-row">
        <div class="badge" id="logoBadge">
          <img src="icon-192.png" alt="BED logo" onerror="this.remove();document.getElementById('logoBadge').innerHTML='<div class=\'fallback\'>BED</div>';">
        </div>
        <h1>INSTALL BED APP</h1>
      </div>
      <p class="muted">Click Install to add the Peer Review Form to your home screen. If you don’t see the button, press ⋮ at the top right and select Add to Home Screen.</p>

      <div id="inAppGate" class="hide">
        <p><strong>Open in your browser to install.</strong></p>
        <p id="gateAndroid" class="hide">Tap ⋮ → Open in Chrome, then press Install.</p>
        <p id="gateIOS" class="hide">Tap ••• → Open in Safari, then Share → Add to Home Screen.</p>
        <a id="openChrome" class="btn hide" href="#">Open in Chrome</a>
      </div>

      <div id="androidBlock" class="hide" style="margin-top:12px">
        <button id="installBtn" class="btn primary" disabled>Install</button>
        <div class="note">If the button doesn’t work, use ⋮ → Add to Home screen.</div>
      </div>

      <div id="iosBlock" class="hide" style="margin-top:12px">
        <h2>Install BED App</h2>
        <ol>
          <li>Tap Share (square with arrow)</li>
          <li>Tap Add to Home Screen</li>
          <li>Tap Add</li>
        </ol>
      </div>
    </div>

    <div class="card hide" id="cardInstalled">
      <h1>BED APP IS INSTALLED</h1>
      <p>Open the BED App from your home screen to access the BED Hospitality 2.0 Peer Review Form.</p>
    </div>
  </main>

<script>
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js').catch(()=>{}); }

  const ua = navigator.userAgent || '';
  const isiOS = /iPad|iPhone|iPod/.test(ua);
  const isAndroid = /Android/.test(ua);
  const inLINE = /Line\//i.test(ua);
  const inFB = /FBAN|FBAV/i.test(ua);
  const inIG = /Instagram/i.test(ua);
  const inAppWebView = inLINE || inFB || inIG;

  // Only show "installed" when actually running as an installed app
  const displayModeStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
  function showInstalled(){
    document.getElementById('cardInstall').classList.add('hide');
    document.getElementById('cardInstalled').classList.remove('hide');
  }
  if (displayModeStandalone) { showInstalled(); }

  if (inAppWebView) {
    const gate = document.getElementById('inAppGate');
    gate.classList.remove('hide');
    if (isAndroid) {
      document.getElementById('gateAndroid').classList.remove('hide');
      const btn = document.getElementById('openChrome');
      btn.classList.remove('hide');
      const url = location.href.replace(/^https?:\/\//,'');
      btn.href = `intent://${url}#Intent;scheme=https;package=com.android.chrome;end`;
    } else if (isiOS) {
      document.getElementById('gateIOS').classList.remove('hide');
    }
  } else {
    if (isAndroid) document.getElementById('androidBlock').classList.remove('hide');
    if (isiOS) document.getElementById('iosBlock').classList.remove('hide');
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const btn = document.getElementById('installBtn');
    if (btn) btn.disabled = false;
  });

  const installBtn = document.getElementById('installBtn');
  if (installBtn) {
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
    });
  }
</script>
</body>
</html>