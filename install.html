<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Install BED SAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="theme-color" content="#1E90FF">

<style>
  :root { --bed-blue:#1E90FF; --ink:#111; --muted:#666; --line:#e5e7eb; --bg:#F7F8FA; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .appbar{
    position:sticky; top:0; background:var(--bed-blue); color:#fff;
    padding:14px 16px; font-weight:700; letter-spacing:.2px;
    display:flex; align-items:center; gap:10px;
    box-shadow:0 1px 0 rgba(0,0,0,.06);
  }
  .appbar .logo{
    width:28px; height:28px; border-radius:8px; background:#fff; color:var(--bed-blue);
    display:grid; place-items:center; font-weight:800; font-size:14px;
  }
  main{max-width:560px;margin:18px auto;padding:0 16px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:20px}
  h1{margin:6px 0 10px;font-size:28px;line-height:1.2}
  p{margin:8px 0}
  .muted{color:var(--muted)}
  .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:1px solid var(--bed-blue);text-decoration:none}
  .btn.primary{background:var(--bed-blue);color:#fff;border:none;font-weight:600}
  .hint{font-size:14px;color:var(--muted)}
  ol{margin:8px 0 0 20px}
  .hide{display:none}
</style>
</head>
<body>
  <header class="appbar">
    <div class="logo">B</div>
    <div>BED HOSPITALITY — Self-Assessment</div>
  </header>

  <main>
    <div class="card">
      <h1>Install BED SAR</h1>
      <p class="muted" id="status">Add the SAR to your home screen for one-tap access.</p>

      <div id="installedNotice" class="hide">
        <p><strong>Already installed.</strong></p>
        <p class="hint">Open BED SAR from your <em>home screen</em>. If you can’t find it, search for “BED SAR”.</p>
      </div>

      <div id="inAppGate" class="hide">
        <p><strong>Open in your browser to install.</strong></p>
        <p id="gateAndroid" class="hide">Tap <em>⋮</em> → <em>Open in Chrome</em>, then press <em>Install</em>.</p>
        <p id="gateIOS" class="hide">Tap <em>•••</em> → <em>Open in Safari</em>, then <em>Share</em> → <em>Add to Home Screen</em>.</p>
        <a id="openChrome" class="btn hide" href="#">Open in Chrome</a>
      </div>

      <div id="androidBlock" class="hide" style="margin-top:12px">
        <button id="installBtn" class="btn primary" disabled>Install</button>
        <p class="hint" id="noPromptHint">If you don’t see the prompt: ⋮ → <em>Add to Home screen</em>.</p>
      </div>

      <div id="iosBlock" class="hide" style="margin-top:12px">
        <p><strong>iPhone</strong></p>
        <ol>
          <li>Tap <em>Share</em> (□ with ↑)</li>
          <li>Tap <em>Add to Home Screen</em></li>
          <li>Tap <em>Add</em></li>
        </ol>
      </div>
    </div>
  </main>

<script>
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js').catch(()=>{}); }

  const ua = navigator.userAgent || '';
  const isiOS = /iPad|iPhone|iPod/.test(ua);
  const isAndroid = /Android/.test(ua);
  const inLINE = /Line\//i.test(ua);
  const inFB = /FBAN|FBAV/i.test(ua);
  const inIG = /Instagram/i.test(ua);
  const inAppWebView = inLINE || inFB || inIG;

  const displayModeStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
  const wasInstalledBefore = localStorage.getItem('bedsar_installed') === '1';
  if (displayModeStandalone || wasInstalledBefore) {
    document.getElementById('installedNotice').classList.remove('hide');
  }

  if (inAppWebView) {
    const gate = document.getElementById('inAppGate');
    gate.classList.remove('hide');
    if (isAndroid) {
      document.getElementById('gateAndroid').classList.remove('hide');
      const btn = document.getElementById('openChrome');
      btn.classList.remove('hide');
      const url = location.href.replace(/^https?:\/\//,'');
      btn.href = `intent://${url}#Intent;scheme=https;package=com.android.chrome;end`;
    } else if (isiOS) {
      document.getElementById('gateIOS').classList.remove('hide');
    }
  } else {
    if (isAndroid) document.getElementById('androidBlock').classList.remove('hide');
    if (isiOS) document.getElementById('iosBlock').classList.remove('hide');
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const btn = document.getElementById('installBtn');
    if (btn) btn.disabled = false;
  });

  const installBtn = document.getElementById('installBtn');
  if (installBtn) {
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
    });
  }

  window.addEventListener('appinstalled', () => {
    localStorage.setItem('bedsar_installed','1');
    document.getElementById('installedNotice').classList.remove('hide');
    if (installBtn) installBtn.disabled = true;
  });
</script>
</body>
</html>